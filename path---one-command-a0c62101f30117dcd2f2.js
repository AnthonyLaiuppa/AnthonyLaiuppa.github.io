webpackJsonp([63503670762747],{820:function(e,t){e.exports={data:{post:{id:"/home/fisctf/blog/content/posts/2019-01-27--one-command/index.md absPath of file >>> MarkdownRemark",html:'<h3>Intro</h3>\n<hr>\n<p>While working on getting better with Terraform I noticed there weren’t alot of examples of Kubernetes and AWS being provisioned at the same time. I forked the sample code provided by the Terraform project, and modularized it. From there I was able to add in a Kubernetes provider and patch in authentication. This allows us to create and provision Kubernetes architecture in AWS with a single command. To give a service to demonstrate, I’ve written a simple API endpoint in Golang and accompanying React front end. Break out your bingo card, there’s alot of buzz words coming your way. </p>\n<h3>Architecture Overview</h3>\n<hr>\n<p>Lets take a look at what all is acheived by our Terraform code.</p>\n<p>This is what our ideal architecture looks like in AWS. Our React front end will be hosted in the S3 bucket.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-c541b.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1UlEQVQoz02Sy27TQBSG82Y8B+JRYMWCReEFWFFYsCGCIoFKQFSkVHXaNA0pocV2nDS2Y8ceX+Nb5szY5viS0tHRzLH0f/r/8ZkOAMOiwMuyfPzy87PXX7ChvAh8nxAHWM4yO/RWI9FwvKAoCsZ4g2B1qoPlqIwC03aCJNTKxZ4rvbuWloa+9HyfczCM1cfDo+mfm3TLgk20pVtgCAPCiOdJ7EXBCj17I+X9/sNx78knQelfyLIk2ra1tmxd003DOL34fSyMHC/cObM6Ay9sx0fFWCEHl/6tMr0afhsePv0lvB1MNVmeeX4Qx5EsK/LfMcsIAN85Y5toprH42j93HUKBTWTT9cLN4mBy8ua7MDk5/bmci8rtyiakyCnQuHZuYQbpmkYLTZ2Z5vpanPd+CIkrbilb6vqr7oez7qPo6AFRR0nGGn1zVDAFwNuqmv7i+R7CrmMXHOhmUcSSv4n3j9X+8Ay07o0ys4KMt2ALV3fGlWXZYHBOCJFUK4gynpeUZvir82oVUJRhUtm0SZvYiFHWzg390zQdXl7Z5pxzHD6702G+yrOqHcxY567DorTOgJ+RBqkF+B7uSe8rK3H9SKBhcOecVz3u1SRoq4PG7b+M1TIU/wMQgGD6sLcm3wAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="Cloud_Arch"\n        title=""\n        src="/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-48538.png"\n        srcset="/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-bed0f.png 200w,\n/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-5fd34.png 400w,\n/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-48538.png 800w,\n/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-b70ec.png 1200w,\n/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-c541b.png 1280w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Further more at the application layer, this is a diagram of Kubernetes architecture that will be implemented.\nThe master is provided by AWS with their EKS, and we bring the worker-nodes with the EC2 instances.\nThe GO-API is ran in single container pods distributed amongst the nodes. </p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-3f7c3.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 77.47680890538034%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABX0lEQVQoz43S6XLCMAwEYL//K3LfEMIVIOEItF/jAmmm06IfGlnWrrSyw8d7VhTFYrHg68nwJvhyuWw2m9vt9gsYZZqmq9XqcDg0YPf7nc/zfDKZNK6+wWVZgm232+v1Wr92xHuuzO0zjvYa20in06nBreFut5MHEzgK8of9ABPWAGdZ1u12l8vldDrt9/ua14WE4/FYVEbwbDaLg/GIFCVJMhwOqQUeDAaO+/0elxq8YT6fx2FURG4juFNkEUbFCO+dYEajkb0qQ2T5QRZeih+Px7hljMrbFvB6vYZXgFcggyUGAYGDaqy9Xg+luqQyeYxY0soc04fR6BhMSJtJFCHCZwu6uYs9Jel/PpLb17bpMa1S70wtnbxlYBFr0mq1DKUs6oyfgscS1NmNyGPWP0D8LRqa3Kr5drutjWKKtP3a9t9fGiNkp9Ph4yIheURE/QPWwZKth9eTCuoML6PzJ87iWrt0tZcsAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="Kube-arch"\n        title=""\n        src="/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-48538.png"\n        srcset="/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-bed0f.png 200w,\n/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-5fd34.png 400w,\n/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-48538.png 800w,\n/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-b70ec.png 1200w,\n/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-d134a.png 1600w,\n/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-f6ead.png 2400w,\n/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-3f7c3.png 2695w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>This distributed setup with Kubernetes steering the ship is what gives the backend of our application scalability, availability, and rolling upgrades.</p>\n<h3>Golang - API</h3>\n<hr>\n<p>Before we get to Terraforming our Kubernetes, we need something to run in our cluster. </p>\n<p>This snippet shows our implementation of the endpoint by using the <code class="language-text">Gin Gonic</code> framework. </p>\n<div class="gatsby-highlight" data-language="go">\n      <pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">v1_timestamp</span><span class="token punctuation">(</span>c <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\ttimestamp <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Unix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> \n\tc<span class="token punctuation">.</span><span class="token function">JSON</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> gin<span class="token punctuation">.</span>H<span class="token punctuation">{</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"Dont let your dreams be dreams. Time:"</span><span class="token punctuation">,</span> <span class="token string">"timestamp"</span><span class="token punctuation">:</span> timestamp<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span>\n\n<span class="token keyword">func</span> <span class="token function">setupRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>gin<span class="token punctuation">.</span>Engine <span class="token punctuation">{</span>\n\tf<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">"api.log"</span><span class="token punctuation">)</span>\n\tgin<span class="token punctuation">.</span>DefaultWriter <span class="token operator">=</span> io<span class="token punctuation">.</span><span class="token function">MultiWriter</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> os<span class="token punctuation">.</span>Stdout<span class="token punctuation">)</span>\n\tgin<span class="token punctuation">.</span><span class="token function">SetMode</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span>ReleaseMode<span class="token punctuation">)</span>\n\tr <span class="token operator">:=</span> gin<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\tr<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\tr<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>gin<span class="token punctuation">.</span><span class="token function">Recovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n\tr<span class="token punctuation">.</span><span class="token function">Use</span><span class="token punctuation">(</span>cors<span class="token punctuation">.</span><span class="token function">Default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> \n\tr<span class="token punctuation">.</span><span class="token function">GET</span><span class="token punctuation">(</span><span class="token string">"/timestamp"</span><span class="token punctuation">,</span> v1_timestamp<span class="token punctuation">)</span>\n\t<span class="token keyword">return</span> r\n<span class="token punctuation">}</span>\n\n<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n\tr <span class="token operator">:=</span> <span class="token function">setupRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>\n\tr<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span><span class="token string">":8080"</span><span class="token punctuation">)</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>From here it’s easy to compile it static with no dependencies, then load it into a Scratch Docker container.</p>\n<p>This gives us a container image to put in our Pod spec that will then be loaded into our cluster. Once loaded, the API will respond to requests at /timestamp.</p>\n<p>Having our backend in Golang means we can easiy put it in any Kubernetes cluster regardless of cloud provider, or compile it for an operating system if so choose.</p>\n<h3>React - Front end</h3>\n<hr>\n<p>React is a powerful Javascript library that we can employ to create single page applications. I used <code class="language-text">create-react-app</code> as a launching point for our front end.</p>\n<p>This pairs well with our Golang API in giving us a decoupled architecture, meaning we will have to craft a CORS (Cross Origin Resource Sharing) handshake for our requests.</p>\n<div class="gatsby-highlight" data-language="java">\n      <pre class="language-java"><code class="language-java">  async <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\n  <span class="token comment">//await fetch(\'http://localhost:8080/timestamp\',{</span>\n    await <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">\'http://api.ezctf.com/timestamp\'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>\n      method<span class="token operator">:</span> <span class="token string">"GET"</span><span class="token punctuation">,</span>\n      mode <span class="token operator">:</span> <span class="token string">"cors"</span><span class="token punctuation">,</span>\n      headers <span class="token operator">:</span> <span class="token punctuation">{</span> \n        <span class="token string">\'Content-Type\'</span><span class="token operator">:</span> <span class="token string">\'application/json\'</span><span class="token punctuation">,</span>\n        <span class="token string">\'Accept\'</span><span class="token operator">:</span> <span class="token string">\'application/json\'</span>\n       <span class="token punctuation">}</span><span class="token punctuation">,</span>\n\t  <span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Response<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> Response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>findresponse<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">{</span>\n        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n          isLoaded<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n          message<span class="token operator">:</span> findresponse<span class="token punctuation">.</span>message<span class="token punctuation">,</span>\n          timestamp<span class="token operator">:</span> findresponse<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span>\n        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>\n      <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">\'Parsing failed\'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>\n\n  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  \tvar <span class="token punctuation">{</span> isLoaded<span class="token punctuation">,</span> message<span class="token punctuation">,</span> timestamp <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">;</span>\n\n  \t<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isLoaded<span class="token punctuation">)</span><span class="token punctuation">{</span>\n  \t\t<span class="token keyword">return</span> <span class="token generics function"><span class="token punctuation">&lt;</span>div<span class="token punctuation">></span></span>Loading<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span> \t<span class="token punctuation">}</span>\n  \t<span class="token keyword">else</span><span class="token punctuation">{</span>\n    \t<span class="token keyword">return</span> <span class="token punctuation">(</span>\n      \t\t<span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"App"</span><span class="token operator">></span>\n            Loaded\n            <span class="token generics function"><span class="token punctuation">&lt;</span>br<span class="token punctuation">></span></span><span class="token operator">&lt;</span><span class="token operator">/</span>br<span class="token operator">></span>\n            <span class="token punctuation">{</span>message<span class="token punctuation">}</span> <span class="token punctuation">{</span>timestamp<span class="token punctuation">}</span>\n      \t\t<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>\n    \t<span class="token punctuation">)</span><span class="token punctuation">;</span>  \t\n    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span></code></pre>\n      </div>\n<p>The benefit of the decoupled architecture is that we can cleanly separate our front end functions and back end functions. Leaving the state in the user’s browser session can allow us to achieve an idempotent back end and architecture. This allows us to scale the back end easily during times of heavy traffic. </p>\n<p>But this is the front end block, what about that? We can static compile our React and host it in an S3 bucket, and if we wanted to go further we could set it up behind a Cloudfront distribution. This would allow our application to be very quickly availble to people all over the world with low latency. </p>\n<p>Compiling the above code and loading it into S3 shows the following when the API is unavailable.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-be609.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 750px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 29.599999999999998%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA50lEQVQY062MUU+CcBTFYSOXT8VGuGU+8qlbPScCOtFMEKOl1BPaI2OAn4MNfv1hsfna6my/nXvu7j3SRa/HZb+PLMsoisLVtcrtcMj9wyOzuYvlTJnYDvZ01ua5u8C0bGyxfxqbjCcWpmC1XvPi+Ui6rnM3GqGqKpqmcTMYYBgG7mLJPvokfHsn2IYEryG7fcQu+mD5vMIPtvibgI1wT3h8OHI4fiF5nodj27iuSxzHFEVBmqYkSUKe54Lsx3OyLGs5nU7iLm9vO29+GiSE6rqmLEv+Q9J5aIqrqvoTUlNyTlfczb/VN3ypmzsRcyBCAAAAAElFTkSuQmCC\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="Loading"\n        title=""\n        src="/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-be609.png"\n        srcset="/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-e50aa.png 200w,\n/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-5a5fd.png 400w,\n/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-be609.png 750w"\n        sizes="(max-width: 750px) 100vw, 750px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>Terraform, Finally</h3>\n<hr>\n<p>I used <a href="https://github.com/terraform-providers/terraform-provider-aws/tree/master/examples/eks-getting-started">EKS Getting Started Guide Configuration</a> as a starting point for getting the cluster up.\nFrom there I modularized the code to make it easier to build upon.\nAfter that I added the <code class="language-text">EKS-State</code> file with a Kubernetes provisioner for our freshly made cluster.</p>\n<p>This is the structure of our Terraform code. </p>\n<div class="gatsby-highlight" data-language="text">\n      <pre class="language-text"><code class="language-text">.\n├── main.tf\n├── modules\n│   ├── eks-cluster\n│   │   └── main.tf\n│   ├── eks-state\n│   │   └── main.tf\n│   ├── eks-worker-nodes\n│   │   └── main.tf\n│   ├── outputs\n│   │   └── main.tf\n│   ├── r53\n│   │   └── main.tf\n│   ├── s3-react\n│   │   └── main.tf\n│   ├── vpc\n│   │   └── main.tf\n│   └── workstation-external-ip\n│       └── main.tf\n└── variables.tf\n\n9 directories, 10 files</code></pre>\n      </div>\n<p>Unfortunately Terraform doesnt have AWS kubernetes authentication wrapped in quite yet, so we have to use a local binary to circumvent this.\nBasically this just means that we need more than the Terraform Binary for this, AWSCLI + AWS-IAM-Authenticator, but installing those is trivial. </p>\n<p><a href="https://github.com/terraform-providers/terraform-provider-aws/pull/4904">Relevant Github Issue</a></p>\n<div class="gatsby-highlight" data-language="bash">\n      <pre class="language-bash"><code class="language-bash">data <span class="token string">"external"</span> <span class="token string">"aws_iam_authenticator"</span> <span class="token punctuation">{</span>\n  program <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"sh"</span>, <span class="token string">"-c"</span>, <span class="token string">"aws-iam-authenticator token -i <span class="token variable">${var.cluster-name}</span> | jq -r -c .status"</span><span class="token punctuation">]</span>\n<span class="token punctuation">}</span>\n\nprovider <span class="token string">"kubernetes"</span> <span class="token punctuation">{</span>\n  host                   <span class="token operator">=</span> <span class="token string">"<span class="token variable">${var.aws_eks_cluster_demo_endpoint}</span>"</span>\n  cluster_ca_certificate <span class="token operator">=</span> <span class="token string">"<span class="token variable">${base64decode(var.aws_eks_cluster_demo_cert_auth_0_data)}</span>"</span>\n  token                  <span class="token operator">=</span> <span class="token string">"<span class="token variable">${data.external.aws_iam_authenticator.result.token}</span>"</span>\n  load_config_file       <span class="token operator">=</span> <span class="token boolean">false</span>\n<span class="token punctuation">}</span>\n\nresource <span class="token string">"kubernetes_config_map"</span> <span class="token string">"aws_auth"</span> <span class="token punctuation">{</span>\n  metadata <span class="token punctuation">{</span>\n    name      <span class="token operator">=</span> <span class="token string">"aws-auth"</span>\n    namespace <span class="token operator">=</span> <span class="token string">"kube-system"</span>\n  <span class="token punctuation">}</span>\n\n  data <span class="token punctuation">{</span>\n    mapRoles <span class="token operator">=</span> <span class="token operator">&lt;&lt;</span><span class="token string">YAML\n- rolearn: <span class="token variable">${var.aws_iam_role_demo_node}</span>\n  username: system:node:{{EC2PrivateDNSName}}\n  groups:\n    - system:bootstrappers\n    - system:nodes\nYAML</span>\n  <span class="token punctuation">}</span>\n<span class="token punctuation">}</span></code></pre>\n      </div>\n<p>With our token in line, our provider is now authorized to modify our Cluster. </p>\n<p>The example EKS-Terraform has an output that you need to use kubectl to apply to cluster in order for the nodes to join. </p>\n<p>Now that we’re using the Kubernetes provider we can simply use the <code class="language-text">kubernetes_config_map</code> resource to join those worker nodes.</p>\n<p>Next Terraform adds the following to the Kubernetes cluster:</p>\n<ul>\n<li>Namespace — Running in the default space is not advised</li>\n<li>Kube<em>config</em>map — Join our nodes to the cluster</li>\n<li>ServiceAccount — A service account on the cluster for our StatefulSets to run under</li>\n<li>Service — A LoadBalancer allowing ingress to our GO-API pods</li>\n<li>StatefulSet — Provisions 3 replicated pods of our GO-API with 1gb attached storage</li>\n</ul>\n<p>In total 36 actions are applied by Terraform. A curl at the end lets us know immediately the service came up correctly.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/complete-bf609ba4a22419c6da80750feb66d1da-b3784.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 21.713729308666018%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5klEQVQY002P2WrCYBCFY/WiFKESm4RYVMSlRJpcSG3jkhhjXLI0QtxK9f1f4zgzUOjFx5kZfs75j9JeZTCDGC3SZpgK5mKHBt0Mfyt3w9uis85lV4ZjlN6/hLLjChVnIvpgu1Cs/IxuXMDaXzDc/8DKL+inR5jLhIISGIsY9fkG6jSCRsbPbogX2ptRLm8MCmd0f4fXMIPiFFe8fZ/hHG7EFXbxi0F2Qo9MWbvJAbXJSmCz6jiAOlujsUzFpE4z7xyqcQOuplMy1/5D8zZy44r6P9RZJL/jmQMeRx6ePnxUPwMJ4+p3jgqBDMHQOE4AAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="Complete"\n        title=""\n        src="/static/complete-bf609ba4a22419c6da80750feb66d1da-48538.png"\n        srcset="/static/complete-bf609ba4a22419c6da80750feb66d1da-bed0f.png 200w,\n/static/complete-bf609ba4a22419c6da80750feb66d1da-5fd34.png 400w,\n/static/complete-bf609ba4a22419c6da80750feb66d1da-48538.png 800w,\n/static/complete-bf609ba4a22419c6da80750feb66d1da-b3784.png 1027w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>We can use <code class="language-text">aws eks update-kubeconfig --name timestamp-kube</code> to update our kubeconfig so we can inspect our cluster with <code class="language-text">kubectl</code></p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-fdcf4.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 14.241001564945227%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoElEQVQI13WOSw+CMBCEexAQX7EkEk08eFQPyktNW0AI+AjRxP//Z8bd4tXDl5ltZmcr5qrBunmBdVV35N+QusXm/rFvflpinF3hJwVG5IdJDjcy8OLcei82WFadzTBCqtaWLIoHQoJ9YG6QVMZLvMw4Rw0n0lYHB9XPP7jDpWI+IAL6zexSIyyftmxyrjClmYNim0LsTxC7rNd/cI4zxBfvRVkSxRSZKQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="Kubectl"\n        title=""\n        src="/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-48538.png"\n        srcset="/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-bed0f.png 200w,\n/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-5fd34.png 400w,\n/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-48538.png 800w,\n/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-b70ec.png 1200w,\n/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-d134a.png 1600w,\n/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-fdcf4.png 1917w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>With all this back end infrastructure up, lets take a look at the browser again.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/api-de97d4acf1b010c482c9751b9b29a9e8-26360.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 20.993589743589745%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVQY05WLy06DUBRF70irhQTiN+jAmf0tSyJvSvVn6ldZ7AMuAxkgjzqELG+vGMeeZGU/so+4u7G4vbe5tAxsy+ZiNuNqbjA3Ta4NEyHEf/kLD4sF6fMLT55PGCcEUczScXhcOnh+oHs/DFml64l0Yk2iNE5WiCCK8L0A13XZbF6RsuRtm/G+27PNMu1/8k5zyHNkWZIXkkJKjnnB/nDU/qOqEKgbx5Ff7fueruto25a6rrVvmkbxSa/81+mkN5V6PvfdtDupfhgGvgGAPtC37WwiIQAAAABJRU5ErkJggg==\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="API"\n        title=""\n        src="/static/api-de97d4acf1b010c482c9751b9b29a9e8-48538.png"\n        srcset="/static/api-de97d4acf1b010c482c9751b9b29a9e8-bed0f.png 200w,\n/static/api-de97d4acf1b010c482c9751b9b29a9e8-5fd34.png 400w,\n/static/api-de97d4acf1b010c482c9751b9b29a9e8-48538.png 800w,\n/static/api-de97d4acf1b010c482c9751b9b29a9e8-b70ec.png 1200w,\n/static/api-de97d4acf1b010c482c9751b9b29a9e8-26360.png 1248w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>With the api subdomain properly displaying our JSON, the front end should now load.</p>\n<p>\n  <a\n    class="gatsby-resp-image-link"\n    href="/static/loaded-656be56160a96a59cc733f96b1c4708d-b7508.png"\n    style="display: block"\n    target="_blank"\n    rel="noopener"\n  >\n  \n  <span\n    class="gatsby-resp-image-wrapper"\n    style="position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"\n  >\n    <span\n      class="gatsby-resp-image-background-image"\n      style="padding-bottom: 16.77018633540373%; position: relative; bottom: 0; left: 0; background-image: url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAApElEQVQI142NWwqCQBiF3UPRa9S2ItpARNuSkrDyDkEtwhWkOAkGjQhzPc1M9d4PH+fyPxxvOptjNJ5gsVzhGCXw9wGCQwh/Fzh/Ml2c5kjyAklWOLU5PEeI0sx1cZbjcr1hvdnC6ykFpS8MwwAhBDjnEAb+RUrpfoQQtG1reKCqKpRliaZp8Ow6k++o6xp9T+Hhj9Naf4Z+g0aVUm7MesaYw94bQP3UR63amBUAAAAASUVORK5CYII=\'); background-size: cover; display: block;"\n    >\n      <img\n        class="gatsby-resp-image-image"\n        style="width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;"\n        alt="Loaded"\n        title=""\n        src="/static/loaded-656be56160a96a59cc733f96b1c4708d-48538.png"\n        srcset="/static/loaded-656be56160a96a59cc733f96b1c4708d-bed0f.png 200w,\n/static/loaded-656be56160a96a59cc733f96b1c4708d-5fd34.png 400w,\n/static/loaded-656be56160a96a59cc733f96b1c4708d-48538.png 800w,\n/static/loaded-656be56160a96a59cc733f96b1c4708d-b7508.png 805w"\n        sizes="(max-width: 800px) 100vw, 800px"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Success! Our front end and back end have successfully communicated. </p>\n<p>With Terraform managing our infrastructure, we are free to focus on our application code. Maybe add a database of motivational messages to pull from and display them in a table.</p>\n<p>As an added benefit to this model, updating production code is as easy as just pushing code. Of course you would want to implement a more robust pipeline.</p>\n<p>Pushing new React code is as easy as updating the S3 bucket and all we need to push new Golang is to update our container using Kubernetes versioning.</p>\n<p><code class="language-text">kubectl rolling-update timestamp-v1 timestamp-v2 --image=timestamp:v2</code></p>\n<p>The revision will kick off a <a href="https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/">rolling update</a> giving our back end continuous integration and delivery with zero downtime. Not to mention rollbacks are easy, just <code class="language-text">--rollback</code>.</p>\n<p>To further expand our Terraform code we could add support for <code class="language-text">workspace</code> naming and then testing new modules without disturbing our production environment. </p>\n<h3>Conclusion</h3>\n<hr>\n<p>Wrapping an eco system of components with high interopability in Terraform allows us to achieve alot in just one command. </p>\n<p>That being <code class="language-text">terraform apply --auto-approve</code> , which in production would be a longer string when ran in a pipeline as you inject env vars or credentials.</p>\n<p>This post could’ve been packed with much more but for readability I’m attempting to keep them at a reasonable length.</p>\n<p>If you’d like to see the code or make your own changes <a href="https://github.com/AnthonyLaiuppa/timestamp">here it is on my Github</a>. Fair warning, running it will cost you an AWS bill.</p>',
htmlAst:{type:"root",children:[{type:"element",tagName:"h3",properties:{},children:[{type:"text",value:"Intro"}]},{type:"text",value:"\n"},{type:"element",tagName:"hr",properties:{},children:[]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"While working on getting better with Terraform I noticed there weren’t alot of examples of Kubernetes and AWS being provisioned at the same time. I forked the sample code provided by the Terraform project, and modularized it. From there I was able to add in a Kubernetes provider and patch in authentication. This allows us to create and provision Kubernetes architecture in AWS with a single command. To give a service to demonstrate, I’ve written a simple API endpoint in Golang and accompanying React front end. Break out your bingo card, there’s alot of buzz words coming your way. "}]},{type:"text",value:"\n"},{type:"element",tagName:"h3",properties:{},children:[{type:"text",value:"Architecture Overview"}]},{type:"text",value:"\n"},{type:"element",tagName:"hr",properties:{},children:[]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Lets take a look at what all is acheived by our Terraform code."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"This is what our ideal architecture looks like in AWS. Our React front end will be hosted in the S3 bucket."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"a",properties:{className:["gatsby-resp-image-link"],href:"/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-c541b.png",style:"display: block",target:"_blank",rel:["noopener"]},children:[{type:"text",value:"\n  \n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAAB1UlEQVQoz02Sy27TQBSG82Y8B+JRYMWCReEFWFFYsCGCIoFKQFSkVHXaNA0pocV2nDS2Y8ceX+Nb5szY5viS0tHRzLH0f/r/8ZkOAMOiwMuyfPzy87PXX7ChvAh8nxAHWM4yO/RWI9FwvKAoCsZ4g2B1qoPlqIwC03aCJNTKxZ4rvbuWloa+9HyfczCM1cfDo+mfm3TLgk20pVtgCAPCiOdJ7EXBCj17I+X9/sNx78knQelfyLIk2ra1tmxd003DOL34fSyMHC/cObM6Ay9sx0fFWCEHl/6tMr0afhsePv0lvB1MNVmeeX4Qx5EsK/LfMcsIAN85Y5toprH42j93HUKBTWTT9cLN4mBy8ua7MDk5/bmci8rtyiakyCnQuHZuYQbpmkYLTZ2Z5vpanPd+CIkrbilb6vqr7oez7qPo6AFRR0nGGn1zVDAFwNuqmv7i+R7CrmMXHOhmUcSSv4n3j9X+8Ay07o0ys4KMt2ALV3fGlWXZYHBOCJFUK4gynpeUZvir82oVUJRhUtm0SZvYiFHWzg390zQdXl7Z5pxzHD6702G+yrOqHcxY567DorTOgJ+RBqkF+B7uSe8rK3H9SKBhcOecVz3u1SRoq4PG7b+M1TIU/wMQgGD6sLcm3wAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;",alt:"Cloud_Arch",title:"",src:"/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-48538.png",srcSet:["/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-bed0f.png 200w","/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-5fd34.png 400w","/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-48538.png 800w","/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-b70ec.png 1200w","/static/arch-c75d07f9fbe6ec6d4ed6ab806be77ee3-c541b.png 1280w"],sizes:["(max-width:","800px)","100vw,","800px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  \n  "}]},{type:"text",value:"\n    "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Further more at the application layer, this is a diagram of Kubernetes architecture that will be implemented.\nThe master is provided by AWS with their EKS, and we bring the worker-nodes with the EC2 instances.\nThe GO-API is ran in single container pods distributed amongst the nodes. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"a",properties:{className:["gatsby-resp-image-link"],href:"/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-3f7c3.png",style:"display: block",target:"_blank",rel:["noopener"]},children:[{type:"text",value:"\n  \n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 77.47680890538034%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAAsSAAALEgHS3X78AAABX0lEQVQoz43S6XLCMAwEYL//K3LfEMIVIOEItF/jAmmm06IfGlnWrrSyw8d7VhTFYrHg68nwJvhyuWw2m9vt9gsYZZqmq9XqcDg0YPf7nc/zfDKZNK6+wWVZgm232+v1Wr92xHuuzO0zjvYa20in06nBreFut5MHEzgK8of9ABPWAGdZ1u12l8vldDrt9/ua14WE4/FYVEbwbDaLg/GIFCVJMhwOqQUeDAaO+/0elxq8YT6fx2FURG4juFNkEUbFCO+dYEajkb0qQ2T5QRZeih+Px7hljMrbFvB6vYZXgFcggyUGAYGDaqy9Xg+luqQyeYxY0soc04fR6BhMSJtJFCHCZwu6uYs9Jel/PpLb17bpMa1S70wtnbxlYBFr0mq1DKUs6oyfgscS1NmNyGPWP0D8LRqa3Kr5drutjWKKtP3a9t9fGiNkp9Ph4yIheURE/QPWwZKth9eTCuoML6PzJ87iWrt0tZcsAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;",alt:"Kube-arch",title:"",src:"/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-48538.png",srcSet:["/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-bed0f.png 200w","/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-5fd34.png 400w","/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-48538.png 800w","/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-b70ec.png 1200w","/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-d134a.png 1600w","/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-f6ead.png 2400w","/static/kub_arch-81bdcf965c38d0cecd9b7bedc95bd279-3f7c3.png 2695w"],sizes:["(max-width:","800px)","100vw,","800px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  \n  "}]},{type:"text",value:"\n    "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"This distributed setup with Kubernetes steering the ship is what gives the backend of our application scalability, availability, and rolling upgrades."}]},{type:"text",value:"\n"},{type:"element",tagName:"h3",properties:{},children:[{type:"text",value:"Golang - API"}]},{type:"text",value:"\n"},{type:"element",tagName:"hr",properties:{},children:[]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Before we get to Terraforming our Kubernetes, we need something to run in our cluster. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"This snippet shows our implementation of the endpoint by using the "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"Gin Gonic"}]},{type:"text",value:" framework. "}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"go"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-go"]},children:[{type:"element",tagName:"code",properties:{className:["language-go"]},children:[{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"func"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"v1_timestamp"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"c "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"gin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Context"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\ttimestamp "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":="}]},{type:"text",value:" time"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Now"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Unix"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" \n\tc"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"JSON"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","number"]},children:[{type:"text",value:"200"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" gin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"H"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"message"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"Dont let your dreams be dreams. Time:"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"timestamp"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:":"}]},{type:"text",value:" timestamp"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n"},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"func"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"setupRouter"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"*"}]},{type:"text",value:"gin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Engine "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tf"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","boolean"]},children:[{type:"text",value:"_"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":="}]},{type:"text",value:" os"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Create"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"api.log"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tgin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"DefaultWriter "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" io"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"MultiWriter"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"f"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" os"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"Stdout"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tgin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"SetMode"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"gin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"ReleaseMode"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tr "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":="}]},{type:"text",value:" gin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"New"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tr"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Use"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"gin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Logger"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tr"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Use"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"gin"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Recovery"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tr"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Use"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"cors"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Default"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" \n\tr"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"GET"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"/timestamp"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" v1_timestamp"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\t"},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" r\n"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n"},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"func"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"main"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n\tr "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"setupRouter"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n\tr"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"Run"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'":8080"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"From here it’s easy to compile it static with no dependencies, then load it into a Scratch Docker container."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"This gives us a container image to put in our Pod spec that will then be loaded into our cluster. Once loaded, the API will respond to requests at /timestamp."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Having our backend in Golang means we can easiy put it in any Kubernetes cluster regardless of cloud provider, or compile it for an operating system if so choose."}]},{type:"text",value:"\n"},{type:"element",tagName:"h3",properties:{},children:[{type:"text",value:"React - Front end"}]},{type:"text",value:"\n"},{type:"element",tagName:"hr",properties:{},children:[]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"React is a powerful Javascript library that we can employ to create single page applications. I used "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"create-react-app"}]},{type:"text",value:" as a launching point for our front end."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"This pairs well with our Golang API in giving us a decoupled architecture, meaning we will have to craft a CORS (Cross Origin Resource Sharing) handshake for our requests."}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"java"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-java"]},children:[{type:"element",tagName:"code",properties:{className:["language-java"]},children:[{type:"text",value:"  async "},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"fetchData"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  "},{type:"element",tagName:"span",properties:{className:["token","comment"]},children:[{type:"text",value:"//await fetch('http://localhost:8080/timestamp',{"}]},{type:"text",value:"\n    await "},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"fetch"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:"'http://api.ezctf.com/timestamp'"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n      method"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"GET"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n      mode "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"cors"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n      headers "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:" \n        "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:"'Content-Type'"}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:"'application/json'"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n        "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:"'Accept'"}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:"'application/json'"}]},{type:"text",value:"\n       "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n\t  "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n      "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"then"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"Response"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:">"}]},{type:"text",value:" Response"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"json"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n      "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"then"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"findresponse"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:">"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n        "},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"this"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"setState"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n          isLoaded"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","boolean"]},children:[{type:"text",value:"true"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n          message"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" findresponse"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"message"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]
},children:[{type:"text",value:","}]},{type:"text",value:"\n          timestamp"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:":"}]},{type:"text",value:" findresponse"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"timestamp"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:"\n        "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"\n      "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"catch"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"error "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:">"}]},{type:"text",value:" console"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"log"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:"'Parsing failed'"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" error"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:"  "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n  "},{type:"element",tagName:"span",properties:{className:["token","function"]},children:[{type:"text",value:"render"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  \tvar "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:" isLoaded"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" message"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:","}]},{type:"text",value:" timestamp "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"this"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:"state"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"\n\n  \t"},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"if"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"!"}]},{type:"text",value:"isLoaded"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  \t\t"},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","generics","function"]},children:[{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"<"}]},{type:"text",value:"div"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:">"}]}]},{type:"text",value:"Loading"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"."}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"<"}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"/"}]},{type:"text",value:"div"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:">"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:" \t"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n  \t"},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"else"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    \t"},{type:"element",tagName:"span",properties:{className:["token","keyword"]},children:[{type:"text",value:"return"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"("}]},{type:"text",value:"\n      \t\t"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"<"}]},{type:"text",value:"div className"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"App"'}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:">"}]},{type:"text",value:"\n            Loaded\n            "},{type:"element",tagName:"span",properties:{className:["token","generics","function"]},children:[{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"<"}]},{type:"text",value:"br"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:">"}]}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"<"}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"/"}]},{type:"text",value:"br"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:">"}]},{type:"text",value:"\n            "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"message"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"timestamp"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n      \t\t"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"<"}]},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"/"}]},{type:"text",value:"div"},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:">"}]},{type:"text",value:"\n    \t"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:")"}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:";"}]},{type:"text",value:"  \t\n    "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"  "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"The benefit of the decoupled architecture is that we can cleanly separate our front end functions and back end functions. Leaving the state in the user’s browser session can allow us to achieve an idempotent back end and architecture. This allows us to scale the back end easily during times of heavy traffic. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"But this is the front end block, what about that? We can static compile our React and host it in an S3 bucket, and if we wanted to go further we could set it up behind a Cloudfront distribution. This would allow our application to be very quickly availble to people all over the world with low latency. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Compiling the above code and loading it into S3 shows the following when the API is unavailable."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"a",properties:{className:["gatsby-resp-image-link"],href:"/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-be609.png",style:"display: block",target:"_blank",rel:["noopener"]},children:[{type:"text",value:"\n  \n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 750px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 29.599999999999998%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA50lEQVQY062MUU+CcBTFYSOXT8VGuGU+8qlbPScCOtFMEKOl1BPaI2OAn4MNfv1hsfna6my/nXvu7j3SRa/HZb+PLMsoisLVtcrtcMj9wyOzuYvlTJnYDvZ01ua5u8C0bGyxfxqbjCcWpmC1XvPi+Ui6rnM3GqGqKpqmcTMYYBgG7mLJPvokfHsn2IYEryG7fcQu+mD5vMIPtvibgI1wT3h8OHI4fiF5nodj27iuSxzHFEVBmqYkSUKe54Lsx3OyLGs5nU7iLm9vO29+GiSE6rqmLEv+Q9J5aIqrqvoTUlNyTlfczb/VN3ypmzsRcyBCAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;",alt:"Loading",title:"",src:"/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-be609.png",srcSet:["/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-e50aa.png 200w","/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-5a5fd.png 400w","/static/loading-28b2a8f6a8da317d4e6a6894cd9cabd3-be609.png 750w"],sizes:["(max-width:","750px)","100vw,","750px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  \n  "}]},{type:"text",value:"\n    "}]},{type:"text",value:"\n"},{type:"element",tagName:"h3",properties:{},children:[{type:"text",value:"Terraform, Finally"}]},{type:"text",value:"\n"},{type:"element",tagName:"hr",properties:{},children:[]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"I used "},{type:"element",tagName:"a",properties:{href:"https://github.com/terraform-providers/terraform-provider-aws/tree/master/examples/eks-getting-started"},children:[{type:"text",value:"EKS Getting Started Guide Configuration"}]},{type:"text",value:" as a starting point for getting the cluster up.\nFrom there I modularized the code to make it easier to build upon.\nAfter that I added the "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"EKS-State"}]},{type:"text",value:" file with a Kubernetes provisioner for our freshly made cluster."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"This is the structure of our Terraform code. "}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"text"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-text"]},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:".\n├── main.tf\n├── modules\n│   ├── eks-cluster\n│   │   └── main.tf\n│   ├── eks-state\n│   │   └── main.tf\n│   ├── eks-worker-nodes\n│   │   └── main.tf\n│   ├── outputs\n│   │   └── main.tf\n│   ├── r53\n│   │   └── main.tf\n│   ├── s3-react\n│   │   └── main.tf\n│   ├── vpc\n│   │   └── main.tf\n│   └── workstation-external-ip\n│       └── main.tf\n└── variables.tf\n\n9 directories, 10 files"}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Unfortunately Terraform doesnt have AWS kubernetes authentication wrapped in quite yet, so we have to use a local binary to circumvent this.\nBasically this just means that we need more than the Terraform Binary for this, AWSCLI + AWS-IAM-Authenticator, but installing those is trivial. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"element",tagName:"a",properties:{href:"https://github.com/terraform-providers/terraform-provider-aws/pull/4904"},children:[{type:"text",value:"Relevant Github Issue"}]}]},{type:"text",value:"\n"},{type:"element",tagName:"div",properties:{className:["gatsby-highlight"],dataLanguage:"bash"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"pre",properties:{className:["language-bash"]},children:[{type:"element",tagName:"code",properties:{className:["language-bash"]},children:[{type:"text",value:"data "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"external"'}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"aws_iam_authenticator"'}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  program "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"["}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"sh"'}]},{type:"text",value:", "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"-c"'}]},{type:"text",value:", "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"aws-iam-authenticator token -i '},{type:"element",tagName:"span",properties:{className:["token","variable"]},children:[{type:"text",value:"${var.cluster-name}"}]},{type:"text",value:' | jq -r -c .status"'}]},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"]"}]},{type:"text",value:"\n"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\nprovider "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"kubernetes"'}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  host                   "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"'},{type:"element",tagName:"span",properties:{className:["token","variable"]},children:[{type:"text",value:"${var.aws_eks_cluster_demo_endpoint}"}]},{type:"text",value:'"'}]},{type:"text",value:"\n  cluster_ca_certificate "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"'},{type:"element",tagName:"span",properties:{className:["token","variable"]},children:[{type:"text",value:"${base64decode(var.aws_eks_cluster_demo_cert_auth_0_data)}"}]},{type:"text",value:'"'}]},{type:"text",value:"\n  token                  "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"'},{type:"element",tagName:"span",properties:{className:["token","variable"]},children:[{type:"text",value:"${data.external.aws_iam_authenticator.result.token}"}]},{type:"text",value:'"'}]},{type:"text",value:"\n  load_config_file       "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","boolean"]},children:[{type:"text",value:"false"}]},{type:"text",value:"\n"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\nresource "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"kubernetes_config_map"'}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"aws_auth"'}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n  metadata "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    name      "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"aws-auth"'}]},{type:"text",value:"\n    namespace "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:'"kube-system"'}]},{type:"text",value:"\n  "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n\n  data "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"{"}]},{type:"text",value:"\n    mapRoles "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"="}]},{type:"text",value:" "},{type:"element",tagName:"span",properties:{className:["token","operator"]},children:[{type:"text",value:"<<"}]},{type:"element",tagName:"span",properties:{className:["token","string"]},children:[{type:"text",value:"YAML\n- rolearn: "},{type:"element",tagName:"span",properties:{className:["token","variable"]},children:[{type:"text",value:"${var.aws_iam_role_demo_node}"}]},{type:"text",value:"\n  username: system:node:{{EC2PrivateDNSName}}\n  groups:\n    - system:bootstrappers\n    - system:nodes\nYAML"}]},{type:"text",value:"\n  "},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]},{type:"text",value:"\n"},{type:"element",tagName:"span",properties:{className:["token","punctuation"]},children:[{type:"text",value:"}"}]}]}]},{type:"text",value:"\n      "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"With our token in line, our provider is now authorized to modify our Cluster. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"The example EKS-Terraform has an output that you need to use kubectl to apply to cluster in order for the nodes to join. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Now that we’re using the Kubernetes provider we can simply use the "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"kubernetes_config_map"}]},{type:"text",value:" resource to join those worker nodes."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Next Terraform adds the following to the Kubernetes cluster:"}]},{type:"text",value:"\n"},{type:"element",tagName:"ul",properties:{},children:[{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Namespace — Running in the default space is not advised"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Kube"},{type:"element",tagName:"em",properties:{},children:[{type:"text",value:"config"}]},{type:"text",value:"map — Join our nodes to the cluster"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"ServiceAccount — A service account on the cluster for our StatefulSets to run under"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"Service — A LoadBalancer allowing ingress to our GO-API pods"}]},{type:"text",value:"\n"},{type:"element",tagName:"li",properties:{},children:[{type:"text",value:"StatefulSet — Provisions 3 replicated pods of our GO-API with 1gb attached storage"}]},{type:"text",value:"\n"}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"In total 36 actions are applied by Terraform. A curl at the end lets us know immediately the service came up correctly."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"a",properties:{className:["gatsby-resp-image-link"],href:"/static/complete-bf609ba4a22419c6da80750feb66d1da-b3784.png",style:"display: block",target:"_blank",rel:["noopener"]},children:[{type:"text",value:"\n  \n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 21.713729308666018%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5klEQVQY002P2WrCYBCFY/WiFKESm4RYVMSlRJpcSG3jkhhjXLI0QtxK9f1f4zgzUOjFx5kZfs75j9JeZTCDGC3SZpgK5mKHBt0Mfyt3w9uis85lV4ZjlN6/hLLjChVnIvpgu1Cs/IxuXMDaXzDc/8DKL+inR5jLhIISGIsY9fkG6jSCRsbPbogX2ptRLm8MCmd0f4fXMIPiFFe8fZ/hHG7EFXbxi0F2Qo9MWbvJAbXJSmCz6jiAOlujsUzFpE4z7xyqcQOuplMy1/5D8zZy44r6P9RZJL/jmQMeRx6ePnxUPwMJ4+p3jgqBDMHQOE4AAAAASUVORK5CYII='); background-size: cover; display: block;"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;",alt:"Complete",title:"",src:"/static/complete-bf609ba4a22419c6da80750feb66d1da-48538.png",srcSet:["/static/complete-bf609ba4a22419c6da80750feb66d1da-bed0f.png 200w","/static/complete-bf609ba4a22419c6da80750feb66d1da-5fd34.png 400w","/static/complete-bf609ba4a22419c6da80750feb66d1da-48538.png 800w","/static/complete-bf609ba4a22419c6da80750feb66d1da-b3784.png 1027w"],sizes:["(max-width:","800px)","100vw,","800px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  \n  "}]},{type:"text",value:"\n    "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"We can use "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"aws eks update-kubeconfig --name timestamp-kube"}]},{type:"text",value:" to update our kubeconfig so we can inspect our cluster with "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"kubectl"}]}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"a",properties:{className:["gatsby-resp-image-link"],href:"/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-fdcf4.png",style:"display: block",target:"_blank",rel:["noopener"]},children:[{type:"text",value:"\n  \n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 14.241001564945227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoElEQVQI13WOSw+CMBCEexAQX7EkEk08eFQPyktNW0AI+AjRxP//Z8bd4tXDl5ltZmcr5qrBunmBdVV35N+QusXm/rFvflpinF3hJwVG5IdJDjcy8OLcei82WFadzTBCqtaWLIoHQoJ9YG6QVMZLvMw4Rw0n0lYHB9XPP7jDpWI+IAL6zexSIyyftmxyrjClmYNim0LsTxC7rNd/cI4zxBfvRVkSxRSZKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;",alt:"Kubectl",title:"",src:"/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-48538.png",srcSet:["/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-bed0f.png 200w","/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-5fd34.png 400w","/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-48538.png 800w","/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-b70ec.png 1200w","/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-d134a.png 1600w","/static/kubectl-0aa14646b7f8eeb0def081c6628afe6d-fdcf4.png 1917w"],sizes:["(max-width:","800px)","100vw,","800px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  \n  "}]},{type:"text",value:"\n    "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"With all this back end infrastructure up, lets take a look at the browser again."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"a",properties:{className:["gatsby-resp-image-link"],href:"/static/api-de97d4acf1b010c482c9751b9b29a9e8-26360.png",style:"display: block",target:"_blank",rel:["noopener"]},children:[{type:"text",value:"\n  \n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 20.993589743589745%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAzUlEQVQY05WLy06DUBRF70irhQTiN+jAmf0tSyJvSvVn6ldZ7AMuAxkgjzqELG+vGMeeZGU/so+4u7G4vbe5tAxsy+ZiNuNqbjA3Ta4NEyHEf/kLD4sF6fMLT55PGCcEUczScXhcOnh+oHs/DFml64l0Yk2iNE5WiCCK8L0A13XZbF6RsuRtm/G+27PNMu1/8k5zyHNkWZIXkkJKjnnB/nDU/qOqEKgbx5Ff7fueruto25a6rrVvmkbxSa/81+mkN5V6PvfdtDupfhgGvgGAPtC37WwiIQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;",alt:"API",title:"",src:"/static/api-de97d4acf1b010c482c9751b9b29a9e8-48538.png",srcSet:["/static/api-de97d4acf1b010c482c9751b9b29a9e8-bed0f.png 200w","/static/api-de97d4acf1b010c482c9751b9b29a9e8-5fd34.png 400w","/static/api-de97d4acf1b010c482c9751b9b29a9e8-48538.png 800w","/static/api-de97d4acf1b010c482c9751b9b29a9e8-b70ec.png 1200w","/static/api-de97d4acf1b010c482c9751b9b29a9e8-26360.png 1248w"],sizes:["(max-width:","800px)","100vw,","800px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  \n  "}]},{type:"text",value:"\n    "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"With the api subdomain properly displaying our JSON, the front end should now load."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"\n  "},{type:"element",tagName:"a",properties:{className:["gatsby-resp-image-link"],href:"/static/loaded-656be56160a96a59cc733f96b1c4708d-b7508.png",style:"display: block",target:"_blank",rel:["noopener"]},children:[{type:"text",value:"\n  \n  "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-wrapper"],style:"position: relative; display: block; ; max-width: 800px; margin-left: auto; margin-right: auto;"},children:[{type:"text",value:"\n    "},{type:"element",tagName:"span",properties:{className:["gatsby-resp-image-background-image"],style:"padding-bottom: 16.77018633540373%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAApElEQVQI142NWwqCQBiF3UPRa9S2ItpARNuSkrDyDkEtwhWkOAkGjQhzPc1M9d4PH+fyPxxvOptjNJ5gsVzhGCXw9wGCQwh/Fzh/Ml2c5kjyAklWOLU5PEeI0sx1cZbjcr1hvdnC6ykFpS8MwwAhBDjnEAb+RUrpfoQQtG1reKCqKpRliaZp8Ow6k++o6xp9T+Hhj9Naf4Z+g0aVUm7MesaYw94bQP3UR63amBUAAAAASUVORK5CYII='); background-size: cover; display: block;"
},children:[{type:"text",value:"\n      "},{type:"element",tagName:"img",properties:{className:["gatsby-resp-image-image"],style:"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px transparent;",alt:"Loaded",title:"",src:"/static/loaded-656be56160a96a59cc733f96b1c4708d-48538.png",srcSet:["/static/loaded-656be56160a96a59cc733f96b1c4708d-bed0f.png 200w","/static/loaded-656be56160a96a59cc733f96b1c4708d-5fd34.png 400w","/static/loaded-656be56160a96a59cc733f96b1c4708d-48538.png 800w","/static/loaded-656be56160a96a59cc733f96b1c4708d-b7508.png 805w"],sizes:["(max-width:","800px)","100vw,","800px"]},children:[]},{type:"text",value:"\n    "}]},{type:"text",value:"\n  "}]},{type:"text",value:"\n  \n  "}]},{type:"text",value:"\n    "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Success! Our front end and back end have successfully communicated. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"With Terraform managing our infrastructure, we are free to focus on our application code. Maybe add a database of motivational messages to pull from and display them in a table."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"As an added benefit to this model, updating production code is as easy as just pushing code. Of course you would want to implement a more robust pipeline."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Pushing new React code is as easy as updating the S3 bucket and all we need to push new Golang is to update our container using Kubernetes versioning."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"kubectl rolling-update timestamp-v1 timestamp-v2 --image=timestamp:v2"}]}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"The revision will kick off a "},{type:"element",tagName:"a",properties:{href:"https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/"},children:[{type:"text",value:"rolling update"}]},{type:"text",value:" giving our back end continuous integration and delivery with zero downtime. Not to mention rollbacks are easy, just "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"--rollback"}]},{type:"text",value:"."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"To further expand our Terraform code we could add support for "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"workspace"}]},{type:"text",value:" naming and then testing new modules without disturbing our production environment. "}]},{type:"text",value:"\n"},{type:"element",tagName:"h3",properties:{},children:[{type:"text",value:"Conclusion"}]},{type:"text",value:"\n"},{type:"element",tagName:"hr",properties:{},children:[]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"Wrapping an eco system of components with high interopability in Terraform allows us to achieve alot in just one command. "}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"That being "},{type:"element",tagName:"code",properties:{className:["language-text"]},children:[{type:"text",value:"terraform apply --auto-approve"}]},{type:"text",value:" , which in production would be a longer string when ran in a pipeline as you inject env vars or credentials."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"This post could’ve been packed with much more but for readability I’m attempting to keep them at a reasonable length."}]},{type:"text",value:"\n"},{type:"element",tagName:"p",properties:{},children:[{type:"text",value:"If you’d like to see the code or make your own changes "},{type:"element",tagName:"a",properties:{href:"https://github.com/AnthonyLaiuppa/timestamp"},children:[{type:"text",value:"here it is on my Github"}]},{type:"text",value:". Fair warning, running it will cost you an AWS bill."}]}],data:{quirksMode:!1}},fields:{slug:"/one-command/",prefix:"2019-01-27"},frontmatter:{title:"Terraforming complete AWS-Kubernetes clusers",subTitle:"So many buzzwords....",cover:{childImageSharp:{resize:{src:"/static/legowall-0476f3913513cf5e5aa07fd9f3334231-ada8c.jpg"}}}}},author:{id:"/home/fisctf/blog/content/parts/author.md absPath of file >>> MarkdownRemark",html:"<p>If you have any feedback feel free to @ me on twitter, Im always looking to learn.  <strong>-AL</strong></p>"},footnote:{id:"/home/fisctf/blog/content/parts/footnote.md absPath of file >>> MarkdownRemark",html:"<!--* built by [greg lobinski](https://www.greglobinski.com) -->"},site:{siteMetadata:{facebook:{appId:""}}}},pathContext:{slug:"/one-command/"}}}});
//# sourceMappingURL=path---one-command-a0c62101f30117dcd2f2.js.map