<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ObfuscatingPython | A dumping ground for information</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="I got to thinking, you can obfuscate js and vbs when serving up code to people, why not Python? Well to there is that whole whitespace thing and lack of semi-colons, but lets see what we can do.">
<meta property="og:type" content="article">
<meta property="og:title" content="ObfuscatingPython">
<meta property="og:url" content="http://anthonylaiuppa.com/2017/01/02/ObfuscatingPython/index.html">
<meta property="og:site_name" content="A dumping ground for information">
<meta property="og:description" content="I got to thinking, you can obfuscate js and vbs when serving up code to people, why not Python? Well to there is that whole whitespace thing and lack of semi-colons, but lets see what we can do.">
<meta property="og:updated_time" content="2017-01-03T07:21:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ObfuscatingPython">
<meta name="twitter:description" content="I got to thinking, you can obfuscate js and vbs when serving up code to people, why not Python? Well to there is that whole whitespace thing and lack of semi-colons, but lets see what we can do.">
  
    <link rel="alternate" href="/atom.xml" title="A dumping ground for information" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">A dumping ground for information</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">What I have to put a subtitle too?</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/About">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://anthonylaiuppa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-ObfuscatingPython" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/02/ObfuscatingPython/" class="article-date">
  <time datetime="2017-01-03T03:58:19.000Z" itemprop="datePublished">2017-01-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/infosec/">infosec</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ObfuscatingPython
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <blockquote>
<blockquote>
<p>I got to thinking, you can obfuscate js and vbs when serving up code to people, why not Python? Well to there is that whole whitespace thing and lack of semi-colons, but lets see what we can do. </p>
</blockquote>
</blockquote>
<a id="more"></a>
<hr>
<blockquote>
<p>Obfuscation: <em>“To make so confused or opaque as to be difficult to perceive or understand”</em></p>
</blockquote>
<p>In terms of programming one usually doesnt purposefully obfuscate their code as they may wish for others to read it. However within the realm of Cyber Security the opposite often holds true. Many of those who are crafting the code behind malware (or for fun in puzzles/competitions like IOCCC) purposefully make their code as difficult to read as possible using obfuscation. Therefore it is relatively important to understand obfuscation when it comes to code analysis.</p>
<p>Here we will be going through the process of applying basic obfuscation to python code in the below examples.</p>
<hr>
<h3 id="Our-initial-code"><a href="#Our-initial-code" class="headerlink" title="Our initial code"></a>Our initial code</h3><p>Scanner.py is a simple scapy implementation of an arp scan for a local area network. An attacker may find it useful to find all live hosts on a network so they may find potential pivots. However most attackers would probably use something a little more sophisticated in order to remain undetected but for our purposes this will work.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"> </div><div class="line"><span class="keyword">from</span> scapy.all <span class="keyword">import</span> *</div><div class="line"> </div><div class="line"><span class="keyword">try</span>:</div><div class="line">    alive,dead=srp(Ether(dst=<span class="string">"ff:ff:ff:ff:ff:ff"</span>)/ARP(pdst=<span class="string">'192.168.1.0/24'</span>), timeout=<span class="number">2</span>, verbose=<span class="number">0</span>)</div><div class="line">    <span class="keyword">print</span> <span class="string">"MAC - IP"</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(alive)):</div><div class="line">            <span class="keyword">print</span> alive[i][<span class="number">1</span>].hwsrc + <span class="string">" - "</span> + alive[i][<span class="number">1</span>].psrc</div><div class="line"><span class="keyword">except</span>:</div><div class="line">    <span class="keyword">pass</span></div></pre></td></tr></table></figure>
<p>Here is sample output from Scanner.py.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">user@ubuntu:~$ sudo python scanner.py </div><div class="line">[sudo] password for user: </div><div class="line">WARNING: No route found for IPv6 destination :: (no default route?)</div><div class="line">MAC - IP</div><div class="line">00:00:11:11:11:11 - 192.168.1.10</div><div class="line">cc:bb:44:33:22:11 - 192.168.1.1</div><div class="line">dd:ee:ae:45:67:34 - 192.168.1.14</div><div class="line">ff:dd:78:ad:6d:23 - 192.168.1.4</div><div class="line">00:00:00:70:07:e2 - 192.168.1.30</div><div class="line">00:00:11:22:22:22 - 192.168.1.27</div></pre></td></tr></table></figure></p>
<p>Base64 is a common type of encoding that is easy to encode and decode using the python Base64 module. It adds a layer of obfuscation between prying eyes and our code. So the first step we will take will be to encode Scanner.py in Base64. The below code snippet will call the base64 library and encode Scanner.py, then dump it as a single string into output.o</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> base64 </div><div class="line"><span class="comment">#Its all pretty self explanatory</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line"></div><div class="line">    target=open(<span class="string">"scanner.py"</span>, <span class="string">"r"</span>)</div><div class="line">    todo = target.read()</div><div class="line">    target.close()</div><div class="line">    s=base64.b64encode(todo)</div><div class="line">    target = open(<span class="string">"output.o"</span>, <span class="string">"w"</span>)</div><div class="line">    target.write(s)</div><div class="line">    target.close()</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://anthonylaiuppa.com/2017/01/02/ObfuscatingPython/" data-id="cixik96e9000cr7jxiqb47as0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/infosec/">infosec</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/obfuscation/">obfuscation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/re/">re</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/01/03/SANSHHC/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          SANSHHC
        
      </div>
    </a>
  
  
    <a href="/2017/01/02/PythonEncryption/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">PythonEncryption</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/01/03/SANSHHC/">SANSHHC</a>
          </li>
        
          <li>
            <a href="/2017/01/02/ObfuscatingPython/">ObfuscatingPython</a>
          </li>
        
          <li>
            <a href="/2017/01/02/PythonEncryption/">PythonEncryption</a>
          </li>
        
          <li>
            <a href="/2017/01/02/BinaryFun/">BinaryFun</a>
          </li>
        
          <li>
            <a href="/2017/01/01/ProjectEuler/">ProjectEuler</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/infosec/">infosec</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">programming</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/writeups/">writeups</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encryption/">encryption</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/infosec/">infosec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kali/">kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obfuscation/">obfuscation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/projecteuler/">projecteuler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/re/">re</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sans/">sans</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/steganography/">steganography</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ctf/" style="font-size: 10px;">ctf</a> <a href="/tags/encryption/" style="font-size: 15px;">encryption</a> <a href="/tags/infosec/" style="font-size: 20px;">infosec</a> <a href="/tags/kali/" style="font-size: 10px;">kali</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/obfuscation/" style="font-size: 10px;">obfuscation</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/projecteuler/" style="font-size: 10px;">projecteuler</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/re/" style="font-size: 15px;">re</a> <a href="/tags/sans/" style="font-size: 10px;">sans</a> <a href="/tags/steganography/" style="font-size: 10px;">steganography</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Anthony Laiuppa<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/About" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>