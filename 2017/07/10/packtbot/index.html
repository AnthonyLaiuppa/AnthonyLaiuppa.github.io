<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>packtbot | AnthonyLaiuppa.com</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Slack is an effective group communication tool that Ive found myself using quite a bit recently. It simplifies communication greatly eliminating the need for multiple apps. With Slack Im able to inter">
<meta property="og:type" content="article">
<meta property="og:title" content="packtbot">
<meta property="og:url" content="http://anthonylaiuppa.com/2017/07/10/packtbot/index.html">
<meta property="og:site_name" content="AnthonyLaiuppa.com">
<meta property="og:description" content="Slack is an effective group communication tool that Ive found myself using quite a bit recently. It simplifies communication greatly eliminating the need for multiple apps. With Slack Im able to inter">
<meta property="og:image" content="http://anthonylaiuppa.com/2017/07/10/packtbot/soup.PNG">
<meta property="og:image" content="http://anthonylaiuppa.com/2017/07/10/packtbot/packtbot.PNG">
<meta property="og:updated_time" content="2017-07-11T05:01:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="packtbot">
<meta name="twitter:description" content="Slack is an effective group communication tool that Ive found myself using quite a bit recently. It simplifies communication greatly eliminating the need for multiple apps. With Slack Im able to inter">
<meta name="twitter:image" content="http://anthonylaiuppa.com/2017/07/10/packtbot/soup.PNG">
  
    <link rel="alternate" href="/atom.xml" title="AnthonyLaiuppa.com" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">AnthonyLaiuppa.com</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">A repository of potentially interesting information</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/About">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://anthonylaiuppa.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-packtbot" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/10/packtbot/" class="article-date">
  <time datetime="2017-07-11T03:22:08.000Z" itemprop="datePublished">2017-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/programming/">programming</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      packtbot
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Slack is an effective group communication tool that Ive found myself using quite a bit recently. It simplifies communication greatly eliminating the need for multiple apps. With Slack Im able to interact with work, side projects, and the programming community with one application. Where Packt comes into play, is that for the last couple of weeks Ive had a colleague posting packts deal of the day in one of our slack channels daily. So when I found a small block of free time, I decided to apply some simple automation. </p>
<hr>
<a id="more"></a> 
<h3 id="Where-we-start"><a href="#Where-we-start" class="headerlink" title="Where we start"></a>Where we start</h3><p>Writing a slack bot using their API and python is well documented with many examples being available. Infact I was surprised because it was probably the easiest API Ive worked with so far.</p>
<p>Ive also dabbled with web scraping in the past so I figured this would be incredibly quick to throw together something basic. Of course it wouldnt be any fun if I didnt hit a snag or two. </p>
<p>This is a recipe that has been done over plenty of times, requests to grab the page, and then BeautifulSoup to parse our what information we want. </p>
<p>So I threw open a python shell and just pulled the pages HTML and used BeautifulSoup to prettyprint(prettify) it, that way I could form an idea of where to go with this. </p>
<img src="/2017/07/10/packtbot/soup.PNG" alt="First Snag" title="First Snag">
<h4 id="403-Forbidden"><a href="#403-Forbidden" class="headerlink" title="403 - Forbidden"></a>403 - Forbidden</h4><p>Its common for sites to deploy some mechanisms to deter people from scraping their pages. Which is entirely fair since making alot of requests programmatically could potentially bog a site down. But in our case we only want 1 request every 24 hours. Selenium has always been my go to when scraping or testing websites, especially if Im doing a more complicated process and want to see visually what is happening. In this case though since we are pulling just one page, so going headless is much more preferred. With the magic of PhantomJS and selenium we can emulate a browser, so on the site side they see the request as coming from a ‘browser’ and dont give us the 403. </p>
<p>Now I simply swapped out the Requests library for BS4 and reran the script. This time around it worked great! So now that we’re pulling clean HTML, its time to get to parsing. </p>
<p>A little right click and inspect on the packt deal of the day page, revealed the title to be right here</p>
<p><code>&lt;div class=&quot;dotd-title&quot;&gt;&lt;h2&gt;Our Title</code> </p>
<p>BS4 made quick work of this parsing and soon we get the result. </p>
<p><code>[&#39;\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\tMongoDB Cookbook\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t\\t&#39;]</code></p>
<p>Woo! A new line and a bunch of tabs. Weirdly enough while I had some trouble on earlier, I dropped <code>string.strip(&#39;\\n&#39;).strip(&#39;\\t&#39;)</code> in the code after work and it stripped away all of those tabs.</p>
<p>Alright so now that we’ve got the scraping and parsing figured out, lets add our slack code in. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> codecs</div><div class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">from</span> slackclient <span class="keyword">import</span> SlackClient</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_book_title</span><span class="params">(url)</span>:</span></div><div class="line">	driver = webdriver.PhantomJS()</div><div class="line">	driver.set_window_size(<span class="number">1120</span>, <span class="number">550</span>)</div><div class="line">	driver.get(url)</div><div class="line">	response = driver.page_source.encode(<span class="string">'utf-8'</span>)</div><div class="line">	driver.quit()</div><div class="line">	html_str = str(response)</div><div class="line">	soup = BeautifulSoup(html_str, <span class="string">"html.parser"</span>)</div><div class="line">	title = soup.find(<span class="string">'div'</span>, <span class="string">'dotd-title'</span>)</div><div class="line">	children = title.findChildren()</div><div class="line">	<span class="keyword">for</span> child <span class="keyword">in</span> children:</div><div class="line">		print(child.contents)</div><div class="line">		<span class="keyword">return</span> child.contents</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">clean_string</span><span class="params">(title)</span>:</span></div><div class="line">	clean = str(title[<span class="number">0</span>])</div><div class="line">	clean = clean.strip(<span class="string">'\\n'</span>).strip(<span class="string">'\\t'</span>)</div><div class="line">	<span class="keyword">return</span> clean</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">deploy_bot</span><span class="params">(url, title)</span>:</span></div><div class="line">	SLACK_BOT_TOKEN =<span class="string">''</span></div><div class="line">	BOT_NAME = <span class="string">'packtbot'</span></div><div class="line">	slack_client = SlackClient(SLACK_BOT_TOKEN)</div><div class="line">	message = get_message(url,title)</div><div class="line">	<span class="keyword">if</span> slack_client.rtm_connect():</div><div class="line">		slack_client.api_call(<span class="string">"chat.postMessage"</span>, channel=<span class="string">'random'</span>,</div><div class="line">			text=message, as_user=<span class="keyword">True</span>)</div><div class="line">	<span class="keyword">else</span>:</div><div class="line">		print(<span class="string">'Connection failed\n'</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_message</span><span class="params">(url, title)</span>:</span></div><div class="line">	message = <span class="string">'Todays free book is &#123;0&#125; \n'</span>.format(title)</div><div class="line">	message += <span class="string">'Browse over to &#123;0&#125; to claim it!\n'</span>.format(url)</div><div class="line">	<span class="keyword">return</span> message</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">	url=<span class="string">'https://www.packtpub.com/packt/offers/free-learning'</span></div><div class="line">	title = get_book_title(url)</div><div class="line">	title = clean_string(title)</div><div class="line">	deploy_bot(url,title)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">	main()</div></pre></td></tr></table></figure>
<hr>
<h4 id="Results"><a href="#Results" class="headerlink" title="Results"></a>Results</h4><p>We have acheived automation!</p>
<img src="/2017/07/10/packtbot/packtbot.PNG" alt="Our Bot!" title="Our Bot!">
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>Making a slack bot to let me and my coworkers know what the deal of the day is was easy thanks to python and slacks API! </p>
<p>As well as the littany of other tools we put to use. </p>
<p>Theres just one thing though, do I really care about <em>every</em> free book packt has? </p>
<p>I barely have time to read things that interest me. </p>
<p>Fortunately my colleague was sharing with us things he found interesting and relevant. </p>
<p>Sadly my bot cant quite do that, but with the addition of a wordlist I think we can get pretty close. We can tackle that later</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://anthonylaiuppa.com/2017/07/10/packtbot/" data-id="cj4z3xr9d001tf3jx095oq0to" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/beautifulsoup/">beautifulsoup</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/packt/">packt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/selenium/">selenium</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/slack/">slack</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/10/27/BreakingInto_PenTesting/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Breaking Into Penetration Testing
        
      </div>
    </a>
  
  
    <a href="/2017/01/11/URLenumeration/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">URLenumeration</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/17/letsdeploy/">Lets Deploy, Getting started with docker container automation</a>
          </li>
        
          <li>
            <a href="/2017/10/27/BreakingInto_PenTesting/">Breaking Into Penetration Testing</a>
          </li>
        
          <li>
            <a href="/2017/07/10/packtbot/">packtbot</a>
          </li>
        
          <li>
            <a href="/2017/01/11/URLenumeration/">URLenumeration</a>
          </li>
        
          <li>
            <a href="/2017/01/08/Migrating-to-Hexo/">Migrating to Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/infosec/">infosec</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/programming/">programming</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/webdev/">webdev</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/writeups/">writeups</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ansible/">ansible</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/automation/">automation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/beautifulsoup/">beautifulsoup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf/">ctf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/devops/">devops</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/encryption/">encryption</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/infosec/">infosec</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kali/">kali</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/metasploit/">metasploit</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obfuscation/">obfuscation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/packt/">packt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/programming/">programming</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/projecteuler/">projecteuler</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/re/">re</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/requests/">requests</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sans/">sans</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/selenium/">selenium</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/slack/">slack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/steganography/">steganography</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/url-shortener/">url-shortener</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/android/" style="font-size: 10px;">android</a> <a href="/tags/ansible/" style="font-size: 10px;">ansible</a> <a href="/tags/automation/" style="font-size: 10px;">automation</a> <a href="/tags/beautifulsoup/" style="font-size: 10px;">beautifulsoup</a> <a href="/tags/ctf/" style="font-size: 10px;">ctf</a> <a href="/tags/devops/" style="font-size: 10px;">devops</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/encryption/" style="font-size: 13.33px;">encryption</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/infosec/" style="font-size: 16.67px;">infosec</a> <a href="/tags/kali/" style="font-size: 13.33px;">kali</a> <a href="/tags/linux/" style="font-size: 13.33px;">linux</a> <a href="/tags/metasploit/" style="font-size: 10px;">metasploit</a> <a href="/tags/obfuscation/" style="font-size: 10px;">obfuscation</a> <a href="/tags/packt/" style="font-size: 10px;">packt</a> <a href="/tags/programming/" style="font-size: 13.33px;">programming</a> <a href="/tags/projecteuler/" style="font-size: 10px;">projecteuler</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/re/" style="font-size: 13.33px;">re</a> <a href="/tags/requests/" style="font-size: 10px;">requests</a> <a href="/tags/sans/" style="font-size: 10px;">sans</a> <a href="/tags/selenium/" style="font-size: 10px;">selenium</a> <a href="/tags/slack/" style="font-size: 10px;">slack</a> <a href="/tags/steganography/" style="font-size: 10px;">steganography</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/url-shortener/" style="font-size: 10px;">url-shortener</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Anthony Laiuppa<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/About" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>